% 04_two_view_geometry.tex
\documentclass[11pt,a4paper]{article}

\input{preamble.tex}
\title{Two-View Geometry}

\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{corollary}[theorem]{Corollary}
\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}

\begin{document}
\maketitle

\section{Overview}

This document develops the mathematical foundations of two-view geometry.

Given two images of a static scene, our goals are:
\begin{itemize}
  \item Estimate the fundamental matrix
  \item Recover the relative camera pose (up to scale)
  \item Triangulate 3D points
\end{itemize}

\section{Single-View Camera Model}

A pinhole camera maps 3D points in the world to 2D image coordinates via a projective transformation.

\subsection{Camera Projection Matrix}

Let \(X = (X, Y, Z, 1)^\top \in \mathbb{P}^3\) be a 3D point in homogeneous coordinates. 

A camera is represented by the projection matrix
\[
P \in \mathbb{R}^{3\times 4}, \qquad x \sim P X,\quad x\in\mathbb{P}^2
\]

\begin{definition}[Intrinsics and extrinsics]
A common parameterisation is
\[
P = K\,[\,R \mid t\,]
\]
where \(K \in \mathbb{R}^{3\times 3}\) is the intrinsic calibration matrix, and \((R,t)\) describes the rigid transform between world and camera frames with \(R\in SO(3)\), \(t\in\mathbb{R}^3\)
\end{definition}

\subsection{Intrinsic Matrix}

The intrinsic calibration matrix
\(
K \in \mathbb{R}^{3 \times 3}
\)
maps camera-frame coordinates to pixel coordinates:
\[
K =
\begin{bmatrix}
f_x & s   & c_x \\
0   & f_y & c_y \\
0   & 0   & 1
\end{bmatrix}
\]
Given \(\hat{x}\) in intrinsic normalised (calibrated) image coordinates, pixel coordinates are \(x = K\hat{x}\).

Conversely, \(\hat{x} = K^{-1}x\).

\subsection{Rotation and Translation}

The rotation matrix \(R \in SO(3)\) satisfies
\[
R^\top R = I,\quad \det(R)=1
\]
This maps vectors from world coordinates into camera coordinates. 

The translation vector \(t\in\mathbb{R}^3\) determines the camera centre position relative to the world frame (in this convention, \(t\) is expressed in the camera frame). 

\section{Two Views and Relative Pose}

Consider two cameras observing the same 3D point \(X\):
\[
x_1 \sim P_1 X,\qquad x_2 \sim P_2 X
\]
With
\[
P_i = K_i [R_i \mid t_i],\quad i=1,2
\]

\subsection{Relative Pose Simplification}

\begin{proposition}[Choice of world frame]
WLOG, one may choose world coordinates so that the first camera is at the origin with identity orientation, i.e. for some relative pose \((R,t)\)
\[
P_1 = K_1 [I \mid 0], \qquad P_2 = K_2 [R \mid t]
\]

\end{proposition}

\begin{proof}
Trivial.
\end{proof}

\section{Epipolar Geometry}

The two camera centres and a 3D point \(X\) define the epipolar plane. 

Its intersection with each image plane is an epipolar line.

\subsection{A key algebraic tool}

\begin{definition}[Cross-product matrix]
For \(t=(t_x,t_y,t_z)^\top\), define the skew-symmetric matrix
\[
[t]_\times =
\begin{bmatrix}
0 & -t_z & t_y \\
t_z & 0 & -t_x \\
-t_y & t_x & 0
\end{bmatrix}
\]
so that for any \(a\in\mathbb{R}^3\), \([t]_\times a = t \times a\)
\end{definition}

\section{The Essential Matrix (Calibrated Case)}

Assume both cameras are calibrated, and work with intrinsic normalised image coordinates
\[
\hat{x}_1 = K_1^{-1}x_1,\qquad \hat{x}_2 = K_2^{-1}x_2
\]

\begin{theorem}[Essential matrix and epipolar constraint]
Let \(P_1 = [I\mid 0]\), \(P_2 = [R\mid t]\) be the normalised projection matrices (intrinsics removed). Then, there exists a matrix \(E\in\mathbb{R}^{3\times 3}\) such that for corresponding normalised points \(\hat{x}_1,\hat{x}_2\),
\[
\hat{x}_2^\top E \hat{x}_1 = 0,
\qquad \text{and} \qquad
E = [t]_\times R
\]
\end{theorem}

\begin{proof}
Let the 3D point in the first camera frame be \(X_1 \in \mathbb{R}^3\)

Then the second camera frame sees
\[
X_2 = R X_1 + t
\]
Since \(\hat{x}_1\) and \(\hat{x}_2\) represent (homogeneous) directions of the viewing rays, \( \exists \) scalars \(\lambda_1,\lambda_2\neq 0\) such that
\[
X_1 = \lambda_1 \hat{x}_1,\qquad X_2 = \lambda_2 \hat{x}_2
\]
Hence
\[
\lambda_2 \hat{x}_2 = R(\lambda_1 \hat{x}_1) + t
\]
Rearrange to isolate \(t\):
\[
t = \lambda_2 \hat{x}_2 - \lambda_1 R\hat{x}_1
\]
The vectors \(\hat{x}_2\), \(R\hat{x}_1\), and \(t\) lie in the epipolar plane, so they are coplanar and therefore
\[
\hat{x}_2^\top [t]_\times (R\hat{x}_1) = 0
\]
Thus \(\hat{x}_2^\top E \hat{x}_1 = 0\) with \(E:=[t]_\times R\)
\end{proof}

\subsection{Algebraic properties}

\begin{proposition}[Rank constraint]
If \(t\neq 0\), then \(\mathrm{rank}(E)=2\).
\end{proposition}

\begin{proof}
Since \(R\) is invertible, \(\mathrm{rank}([t]_\times R)=\mathrm{rank}([t]_\times) \)
For nonzero \(t\), the linear map \(a\mapsto t\times a\) has a 1D nullspace which is \(\mathrm{span}\{t\}\), so \(\mathrm{rank}([t]_\times)=2\), and \(\mathrm{rank}(E)=2\).

\end{proof}

\begin{proposition}[Singular values of \(E\)]
Any essential matrix \(E=[t]_\times R\) has two equal nonzero singular values and one zero singular value.
\end{proposition}

\begin{proof}
Write \(E = [t]_\times R\). Since \(R\) is orthogonal,
\[
EE^\top = [t]_\times R R^\top [t]_\times^\top = [t]_\times [t]_\times^\top.
\]
A standard identity gives
\[
[t]_\times [t]_\times^\top = \|t\|^2 I - t t^\top.
\]
The matrix \(\|t\|^2 I - tt^\top\) has eigenvalue \(0\) in direction \(t\), and eigenvalue \(\|t\|^2\) on the two-dimensional subspace orthogonal to \(t\). 

Hence \(EE^\top\) has eigenvalues \(\|t\|^2, \|t\|^2, 0\), so \(E\) has singular values \(\|t\|,\|t\|,0\).
\end{proof}

\section{The Fundamental Matrix (Pixel Coordinates)}

For pixel coordinates \(x_i = K_i \hat{x}_i\)

\begin{theorem}[Relation between \(F\) and \(E\)]
The fundamental matrix \(F\) is the unique (up to scale) matrix satisfying
\[
x_2^\top F x_1 = 0 \quad \text{for all corresponding pixels }(x_1,x_2)
\]
and is related to the essential matrix by
\[
E = K_2^\top F K_1,
\qquad \text{or} \qquad
F = K_2^{-\top} E K_1^{-1}
\]
\end{theorem}

\begin{proof}
Start from the essential constraint in intrinsic normalised coordinates:
\[
\hat{x}_2^\top E \hat{x}_1 = 0
\]
Substitute \(\hat{x}_1 = K_1^{-1}x_1\), \(\hat{x}_2 = K_2^{-1}x_2\):
\[
(K_2^{-1}x_2)^\top E (K_1^{-1}x_1)=0
\;\Longleftrightarrow\;
x_2^\top (K_2^{-\top} E K_1^{-1}) x_1 = 0
\]
Thus, \(F := K_2^{-\top} E K_1^{-1}\) satisfies the pixel epipolar constraint. Rearranging gives \(E = K_2^\top F K_1\)
\end{proof}

\subsection{Geometric meaning and basic properties}

\begin{proposition}[Epipolar lines]
Given \(x_1\in\mathbb{P}^2\), define \(l_2 := F x_1\). Then any corresponding point \(x_2\) satisfies \(x_2^\top l_2=0\), i.e. \(x_2\) lies on the line \(l_2\). Similarly, \(l_1 := F^\top x_2\) is the epipolar line in image 1.
\end{proposition}

\begin{proof}
The epipolar constraint is \(x_2^\top F x_1=0\). Set \(l_2:=Fx_1\). Then \(x_2^\top l_2=0\), which is precisely the incidence relation “point \(x_2\) lies on line \(l_2\)” in homogeneous coordinates.
\end{proof}

\begin{proposition}[Rank-2 constraint]
\(\mathrm{rank}(F)=2\).
\end{proposition}

\begin{proof}
From \(F = K_2^{-\top} E K_1^{-1}\), and since \(K_i\) are invertible, \(\mathrm{rank}(F)=\mathrm{rank}(E)\).
In the non-degenerate case \(t\neq 0\), \(\mathrm{rank}(E)=2\) by the earlier proposition, hence \(\mathrm{rank}(F)=2\).
\end{proof}

\begin{proposition}[Epipoles as nullspaces]
There exist points \(e_1,e_2\in\mathbb{P}^2\) (the epipoles) such that
\[
F e_1 = 0, \qquad F^\top e_2 = 0
\]
\end{proposition}

\begin{proof}
Since \(\mathrm{rank}(F)=2\), both nullspaces are one-dimensional. Choose any nonzero \(e_1\in\ker(F)\) and \(e_2\in\ker(F^\top)\). 
\end{proof}

\section{Two-View Estimation from Point Correspondences}

\subsection{Linear Estimation of the Fundamental Matrix}

\begin{proposition}[Linear constraint from one correspondence]
Let \(x_1=(u_1,v_1,1)^\top\) and \(x_2=(u_2,v_2,1)^\top\). Writing \(f=\mathrm{vec}(F)\in\mathbb{R}^9\), the epipolar constraint \(x_2^\top F x_1=0\) is equivalent to a homogeneous linear equation \(a^\top f=0\), where
\[
a = [u_2u_1,\;u_2v_1,\;u_2,\;v_2u_1,\;v_2v_1,\;v_2,\;u_1,\;v_1,\;1]
\]
\end{proposition}

\begin{proof}
Write \(F=(f_{ij})\). Then
\[
x_2^\top F x_1
=
[u_2\;v_2\;1]
\begin{bmatrix}
f_{11} & f_{12} & f_{13}\\
f_{21} & f_{22} & f_{23}\\
f_{31} & f_{32} & f_{33}
\end{bmatrix}
\begin{bmatrix}
u_1\\ v_1\\ 1
\end{bmatrix}
\]
Expanding produces
\[
(u_2u_1)f_{11} + (u_2v_1)f_{12} + (u_2)f_{13}
+ (v_2u_1)f_{21} + (v_2v_1)f_{22} + (v_2)f_{23}
+ (u_1)f_{31} + (v_1)f_{32} + f_{33} = 0
\]
This is precisely \(a^\top f=0\) when \(f\) is the vector of stacked entries of \(F\).
\end{proof}

\begin{proposition}[The 8-point linear system]
Given \(n\) correspondences \(\{(x_1^{(i)},x_2^{(i)})\}_{i=1}^n\)
Define \(A\in\mathbb{R}^{n\times 9}\) by stacking the row vectors \(a^{(i)\top}\) from the previous proposition. Then the epipolar constraints are equivalent to: 
\[
A f = 0
\]
Under noise, a least-squares estimate is obtained by choosing \(f\) as the right singular vector of \(A\) corresponding to the smallest singular value.
\end{proposition}

\begin{proof}
By the variational characterisation of singular values (Rayleigh--Ritz), the minimiser is the right singular vector corresponding to the smallest singular value of \(A\).
\end{proof}

\subsection{Hartley Normalisation}

\begin{theorem}[Hartley normalisation transform]
Let \(\{x^{(i)}\}_{i=1}^n\) be pixel points with \(x^{(i)}=(u^{(i)},v^{(i)},1)^\top\)
Define the centroid
\[
c_x := \frac{1}{n}\sum_{i=1}^n u^{(i)}, 
\qquad
c_y := \frac{1}{n}\sum_{i=1}^n v^{(i)}
\]
Let translated coordinates be
\[
\bar{u}^{(i)} := u^{(i)}-c_x,
\qquad
\bar{v}^{(i)} := v^{(i)}-c_y
\]
Define the mean Euclidean distance from the origin
\[
d := \frac{1}{n}\sum_{i=1}^n \sqrt{(\bar{u}^{(i)})^2+(\bar{v}^{(i)})^2}
\]
Assuming \(d>0\), let \(s:=\sqrt{2}/d\) and define
\[
T :=
\begin{bmatrix}
s & 0 & -s c_x\\
0 & s & -s c_y\\
0 & 0 & 1
\end{bmatrix}
\]
Then, the transformed points \(\tilde{x}^{(i)} := T x^{(i)}\) satisfy:
\begin{enumerate}
\item The centroid of the inhomogeneous coordinates of \(\{\tilde{x}^{(i)}\}\) is at the origin
\item The average Euclidean distance of the inhomogeneous coordinates from the origin is \(\sqrt{2}\)
\end{enumerate}
\end{theorem}

\begin{proof}
Write \(\tilde{x}^{(i)}=(\tilde{u}^{(i)},\tilde{v}^{(i)},1)^\top\)
By construction,
\[
\tilde{u}^{(i)} = s(u^{(i)}-c_x)=s\bar{u}^{(i)},\qquad
\tilde{v}^{(i)} = s(v^{(i)}-c_y)=s\bar{v}^{(i)}
\]
For the centroid,
\[
\frac{1}{n}\sum_i \tilde{u}^{(i)} = s\left(\frac{1}{n}\sum_i (u^{(i)}-c_x)\right)
= s\left(\frac{1}{n}\sum_i u^{(i)} - c_x\right)=0
\]
Similarly, \(\frac{1}{n}\sum_i \tilde{v}^{(i)}=0\)

For the average distance, note that
\[
\sqrt{(\tilde{u}^{(i)})^2+(\tilde{v}^{(i)})^2}
= s\sqrt{(\bar{u}^{(i)})^2+(\bar{v}^{(i)})^2}
\]
Thus, 
\[
\frac{1}{n}\sum_i \sqrt{(\tilde{u}^{(i)})^2+(\tilde{v}^{(i)})^2}
=
s \left(\frac{1}{n}\sum_i \sqrt{(\bar{u}^{(i)})^2+(\bar{v}^{(i)})^2}\right)
= s d = \sqrt{2}
\]
\end{proof}

\begin{proposition}[Effect of normalisation on the fundamental matrix]
Let \(\tilde{x}_1 = T_1 x_1\) and \(\tilde{x}_2 = T_2 x_2\) be similarity transforms applied to the points in images \(1\) and \(2\). 

If \(\tilde{F}\) satisfies
\[
\tilde{x}_2^\top \tilde{F}\,\tilde{x}_1 = 0
\quad \text{for all corresponding } (\tilde{x}_1,\tilde{x}_2)
\]
Then, the corresponding fundamental matrix in the original coordinates is
\[
F = T_2^\top \tilde{F} T_1
\]
\end{proposition}

\begin{proof}
Substitute \(\tilde{x}_1=T_1x_1\) and \(\tilde{x}_2=T_2x_2\) into the normalised epipolar constraint:
\[
(T_2x_2)^\top \tilde{F} (T_1x_1)=0
\;\Longleftrightarrow\;
x_2^\top (T_2^\top \tilde{F} T_1) x_1=0
\]
\end{proof}

\subsection{Rank-2 Enforcement}

\begin{proposition}[Closest rank-2 matrix in Frobenius norm]
Let \(F = U\Sigma V^\top\) be the SVD with \(\Sigma=\mathrm{diag}(\sigma_1,\sigma_2,\sigma_3)\), \(\sigma_1\ge\sigma_2\ge\sigma_3\ge 0\).
Define \(\Sigma'=\mathrm{diag}(\sigma_1,\sigma_2,0)\) and \(F' = U\Sigma' V^\top\).
Then \(F'\) has rank \(2\) and minimises \(\|F-G\|_F\) over all rank-\(2\) matrices \(G\).
\end{proposition}

\begin{proof}
This is the Eckart--Young--Mirsky theorem: the best rank-\(k\) approximation of a matrix in Frobenius norm is obtained by truncating its SVD to the top \(k\) singular values. Take \(k=2\).
\end{proof}

\section{Metric Reconstruction from the Essential Matrix}

This section concerns the geometric reconstruction problem: given the essential matrix, recover the relative camera pose and reconstruct 3D scene points. 

\subsection{Decomposition of the Essential Matrix}

\begin{proposition}[Canonical SVD form]
Let \(E=[t]_\times R\) be an essential matrix with \(t\neq 0\). Then \(E\) has rank \(2\) and singular values \((\|t\|,\|t\|,0)\). In particular, after scaling, one may write an SVD
\[
E = U \Sigma V^\top,
\qquad
\Sigma=\mathrm{diag}(1,1,0)
\]
\end{proposition}

\begin{proof}
The rank and singular value structure were established earlier: \(EE^\top = [t]_\times[t]_\times^\top = \|t\|^2 I - tt^\top\), which has eigenvalues \(\|t\|^2,\|t\|^2,0\). Hence the singular values of \(E\) are \(\|t\|,\|t\|,0\). Since \(E\) is defined up to nonzero scale, we may rescale so that the two nonzero singular values are \(1\), yielding \(\Sigma=\mathrm{diag}(1,1,0)\).
\end{proof}

\begin{theorem}[Pose recovery from \(E\)]
Let \(E\in\mathbb{R}^{3\times 3}\) be an essential matrix with SVD
\[
E = U \Sigma V^\top,
\qquad
\Sigma=\mathrm{diag}(1,1,0).
\]
Define
\[
W =
\begin{bmatrix}
0 & -1 & 0 \\
1 & 0 & 0 \\
0 & 0 & 1
\end{bmatrix},
\qquad
Z =
\begin{bmatrix}
0 & 1 & 0 \\
-1 & 0 & 0 \\
0 & 0 & 0
\end{bmatrix}
\]
Then, the relative rotation and translation direction satisfy
\[
R \in \{UWV^\top,\;UW^\top V^\top\},
\qquad
[t]_\times = U Z U^\top
\]
Yielding four candidate poses \((R,\pm t)\), where \(t\) is determined only up to an unknown overall scale. 

\end{theorem}

\begin{proof}
Since \(\Sigma=\mathrm{diag}(1,1,0)\), we may write
\[
\Sigma = Z W^\top
\]
Because a direct multiplication gives
\[
Z W^\top =
\begin{bmatrix}
0 & 1 & 0 \\
-1 & 0 & 0 \\
0 & 0 & 0
\end{bmatrix}
\begin{bmatrix}
0 & 1 & 0 \\
-1 & 0 & 0 \\
0 & 0 & 1
\end{bmatrix}
=
\begin{bmatrix}
1 & 0 & 0 \\
0 & 1 & 0 \\
0 & 0 & 0
\end{bmatrix}
=\Sigma
\]
Hence
\[
E = U \Sigma V^\top = U Z W^\top V^\top
\]
Define \([t]_\times := U Z U^\top\), which is skew-symmetric because \(Z\) is skew-symmetric and \(U\) is orthogonal. 

Next define candidate rotations
\[
R_1 := U W V^\top, \qquad R_2 := U W^\top V^\top
\]
Using orthogonality \(U^\top U = V^\top V = I\), we compute
\[
[t]_\times R_1
= (U Z U^\top)(U W V^\top)
= U Z W V^\top
\]
Similarly,
\[
[t]_\times R_2
= (U Z U^\top)(U W^\top V^\top)
= U Z W^\top V^\top
\]
Since \(E = U Z W^\top V^\top\), we have \(E = [t]_\times R_2\). The alternative choice \(R_1\) corresponds to a second valid decomposition \(E=[t]_\times R\) because changing \(W\) to \(W^\top\) produces the same essential manifold up to the intrinsic four-fold ambiguity.

Finally, \([t]_\times\) determines \(t\) only up to sign, since \([(-t)]_\times = -[t]_\times\), and \(E\) itself is defined only up to overall nonzero scale, so the magnitude of \(t\) cannot be recovered from two views alone. Combining the two candidate rotations with \(\pm t\) yields four candidate poses.
\end{proof}

\subsection{Cheirality Condition}

\begin{proposition}[Cheirality to select the valid pose]
Let \(P_1=[I\mid 0]\) and \(P_2=[R\mid t]\) be candidate normalised camera matrices obtained from an essential matrix decomposition. For a set of correct correspondences in a non-degenerate configuration, exactly one of the four candidates \((R,\pm t)\) yields triangulated 3D points with positive depth in both camera frames (cheirality).
\end{proposition}

\begin{proof}
For any candidate pose, triangulation yields a projective point \(X\in\mathbb{P}^3\) which, when expressed in each camera frame, has a depth given by the third component of \(X_1\) and \(X_2=RX_1+t\) (up to homogeneous scale). 

Physically valid reconstructions require that the point lies in front of both cameras, i.e. both depths are positive after choosing a consistent scale. 

The four decompositions differ by a reflection of the reconstructed rays with respect to the baseline direction and/or reversal of the translation direction. In a non-degenerate configuration with multiple correspondences, only one choice places the majority of points in front of both cameras simultaneously. Hence cheirality uniquely selects the correct solution.
\end{proof}

\subsection{Triangulation}

\begin{proposition}[Linear triangulation system]
Given two projection matrices \(P_1,P_2\) and corresponding homogeneous image points \(x_1,x_2\in\mathbb{P}^2\), the 3D point \(X\in\mathbb{P}^3\) satisfies
\[
x_i \times (P_i X) = 0,\qquad i=1,2
\]
Each equation yields two independent linear constraints in \(X\). Stacking both views produces a homogeneous system
\[
A X = 0
\]
Solvable (up to scale) by SVD as the right singular vector corresponding to the smallest singular value.
\end{proposition}

\begin{proof}
For fixed \(i\), the relation \(x_i \sim P_iX\) in \(\mathbb{P}^2\) means that \(x_i\) and \(P_iX\) are colinear, which is equivalent to \(x_i \times (P_iX)=0\). The cross product yields three linear equations in the homogeneous coordinates of \(X\), but only two are independent because one equation is a linear combination of the other two due to homogeneity. Selecting two independent rows for each view and stacking them yields a matrix \(A\) such that \(AX=0\). Under noise, the least-squares solution is obtained as the right singular vector associated with the smallest singular value of \(A\).
\end{proof}

\end{document}